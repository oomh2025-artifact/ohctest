<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>最新記事 - 産業保健情報ポータル</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background: #fafafa; color: #222; line-height: 1.7;
      min-height: 100vh; padding: 60px 24px;
    }
    .container { max-width: 720px; margin: 0 auto; }
    
    .back { 
      display: inline-flex; align-items: center; gap: 6px;
      font-size: 0.8rem; color: #888; text-decoration: none; 
      margin-bottom: 40px; transition: color 0.2s;
    }
    .back:hover { color: #ea580c; }
    .back svg { width: 16px; height: 16px; }
    
    h1 { 
      font-size: 1.5rem; font-weight: 600; color: #ea580c;
      margin-bottom: 8px; padding-bottom: 16px;
      border-bottom: 2px solid #ea580c;
    }
    .updated { font-size: 0.75rem; color: #aaa; margin-bottom: 40px; }
    
    .journal { 
      background: #fff; border-radius: 8px; 
      padding: 24px; margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .journal-header { margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0; }
    .journal h2 { font-size: 1rem; font-weight: 600; color: #333; margin-bottom: 2px; }
    .journal h2 a { color: inherit; text-decoration: none; }
    .journal h2 a:hover { color: #ea580c; }
    .journal .meta { font-size: 0.75rem; color: #aaa; }
    
    .article { padding: 12px 0; border-bottom: 1px solid #f5f5f5; }
    .article:last-child { border-bottom: none; padding-bottom: 0; }
    .article-title { font-size: 0.9rem; margin-bottom: 4px; }
    .article-title a { color: #333; text-decoration: none; }
    .article-title a:hover { color: #ea580c; }
    .article-meta { font-size: 0.8rem; color: #999; }
    
    .loading { 
      background: #fff; border-radius: 8px; padding: 60px;
      text-align: center; color: #aaa; font-size: 0.85rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .spinner { 
      width: 32px; height: 32px; border: 2px solid #f0f0f0; 
      border-top-color: #ea580c; border-radius: 50%; 
      animation: spin 0.8s linear infinite; margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    @media (max-width: 540px) {
      body { padding: 40px 16px; }
      h1 { font-size: 1.3rem; }
      .journal { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      トップに戻る
    </a>
    
    <h1>最新記事</h1>
    <div class="updated" id="updated"></div>
    
    <div id="content">
      <div class="loading">
        <div class="spinner"></div>
        J-STAGEから取得中...
      </div>
    </div>
  </div>

  <script>
    const WORKER_URL = "https://sanpo-portal.oomh2025.workers.dev";
    
    const JOURNAL_INFO = {
      sangyoeisei: { name: "産業衛生学雑誌", publisher: "日本産業衛生学会", url: "https://www.jstage.jst.go.jp/browse/sangyoeisei/-char/ja" },
      indhealth: { name: "Industrial Health", publisher: "労働安全衛生総合研究所", url: "https://www.jstage.jst.go.jp/browse/indhealth/-char/ja" },
      ohpfrev: { name: "産業医学レビュー", publisher: "産業医学振興財団", url: "https://www.jstage.jst.go.jp/browse/ohpfrev/-char/ja" },
      jjomh: { name: "産業精神保健", publisher: "日本産業精神保健学会", url: "https://www.jstage.jst.go.jp/browse/jjomh/-char/ja" },
      jaohn: { name: "日本産業看護学会誌", publisher: "日本産業看護学会", url: "https://www.jstage.jst.go.jp/browse/jaohn/-char/ja" },
      jaohl: { name: "産業保健法学会誌", publisher: "日本産業保健法学会", url: "https://www.jstage.jst.go.jp/browse/jaohl/-char/ja" },
    };

    async function loadArticles() {
      const container = document.getElementById("content");
      const updatedEl = document.getElementById("updated");
      
      try {
        const res = await fetch(WORKER_URL);
        if (!res.ok) throw new Error("API error");
        const data = await res.json();
        
        const now = new Date();
        updatedEl.textContent = `最終取得: ${now.toLocaleString("ja-JP")}`;
        
        let html = "";
        for (const journal of data.journals) {
          const info = JOURNAL_INFO[journal.id] || { name: journal.id, publisher: "", url: "#" };
          
          html += `<div class="journal">
            <div class="journal-header">
              <h2><a href="${info.url}" target="_blank">${info.name}</a></h2>
              <div class="meta">${info.publisher}</div>
            </div>`;
          
          if (journal.articles && journal.articles.length > 0) {
            for (const article of journal.articles) {
              const authors = article.authors?.slice(0, 3).join(", ") || "";
              const authorsMore = article.authors?.length > 3 ? " 他" : "";
              const issue = article.year ? `${article.year}年 ${article.volume || ""}巻${article.number || ""}号` : "";
              
              html += `<div class="article">
                <div class="article-title">
                  ${article.link 
                    ? `<a href="${article.link}" target="_blank">${article.title}</a>`
                    : article.title}
                </div>
                <div class="article-meta">${authors}${authorsMore}${issue ? ` / ${issue}` : ""}</div>
              </div>`;
            }
          } else {
            html += `<div class="article"><div class="article-meta">データなし</div></div>`;
          }
          
          html += `</div>`;
        }
        
        container.innerHTML = html;
        
      } catch (e) {
        console.error(e);
        container.innerHTML = `<div class="loading">データの取得に失敗しました。<br>しばらく待ってから再読み込みしてください。</div>`;
      }
    }

    loadArticles();
  </script>
</body>
</html>
