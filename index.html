<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>産業保健情報ポータル</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background: #fafafa; color: #222; line-height: 1.7;
      min-height: 100vh; padding: 80px 24px 60px;
    }
    .container { max-width: 720px; margin: 0 auto; }
    
    h1 {
      font-size: 1.1rem; font-weight: 500; letter-spacing: 0.1em;
      color: #666; text-align: center; margin-bottom: 60px;
    }
    
    .buttons { 
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; 
      margin-bottom: 60px; 
    }
    .btn { 
      aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
      font-size: 1rem; font-weight: 600; color: white; letter-spacing: 0.05em;
      text-decoration: none; border-radius: 4px;
      transition: all 0.3s ease;
    }
    .btn:hover { transform: scale(1.03); }
    .btn-seido { background: #2563eb; }
    .btn-articles { background: #ea580c; }
    .btn-journals { background: #16a34a; }
    
    .news-section h2 {
      font-size: 0.75rem; font-weight: 600; letter-spacing: 0.15em;
      color: #999; margin-bottom: 20px; text-transform: uppercase;
    }
    .news-list { 
      background: #fff; border-radius: 8px; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      overflow: hidden;
    }
    .news-item { 
      display: grid; grid-template-columns: auto 1fr; gap: 16px;
      padding: 16px 20px; 
      text-decoration: none; color: inherit;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.2s;
    }
    .news-item:last-child { border-bottom: none; }
    .news-item:hover { background: #f8f8f8; }
    .news-date { 
      font-size: 0.8rem; color: #999; font-variant-numeric: tabular-nums;
      white-space: nowrap; padding-top: 2px;
    }
    .news-content { min-width: 0; }
    .news-category { 
      font-size: 0.65rem; font-weight: 600; letter-spacing: 0.08em;
      padding: 3px 8px; border-radius: 3px; 
      display: inline-block; margin-bottom: 6px;
    }
    .cat-articles { background: #fff7ed; color: #c2410c; }
    .news-text { 
      font-size: 0.9rem; color: #333; 
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    
    .loading { padding: 40px; text-align: center; color: #aaa; font-size: 0.85rem; }
    
    footer { 
      text-align: center; padding-top: 60px; 
      font-size: 0.7rem; color: #bbb; letter-spacing: 0.05em;
    }

    @media (max-width: 540px) {
      body { padding: 40px 16px 40px; }
      h1 { margin-bottom: 40px; font-size: 1rem; }
      .buttons { gap: 12px; margin-bottom: 40px; }
      .btn { font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>産業保健情報ポータル</h1>
    
    <div class="buttons">
      <a href="seido.html" class="btn btn-seido">制度改正</a>
      <a href="articles.html" class="btn btn-articles">最新記事</a>
      <a href="journals.html" class="btn btn-journals">雑誌一覧</a>
    </div>
    
    <section class="news-section">
      <h2>Latest</h2>
      <div class="news-list" id="news-list">
        <div class="loading">読み込み中...</div>
      </div>
    </section>
  </div>
  
  <footer>SANPO PORTAL</footer>

  <script>
    const WORKER_URL = "https://sanpo-portal.oomh2025.workers.dev";
    
    const JOURNAL_NAMES = {
      sangyoeisei: "産業衛生学雑誌",
      indhealth: "Industrial Health",
      ohpfrev: "産業医学レビュー",
      jjomh: "産業精神保健",
      jaohn: "日本産業看護学会誌",
      jaohl: "産業保健法学会誌",
    };

    async function loadNews() {
      const container = document.getElementById("news-list");
      
      try {
        const res = await fetch(WORKER_URL);
        const data = await res.json();
        
        const allArticles = [];
        for (const journal of data.journals) {
          for (const article of journal.articles.slice(0, 2)) {
            allArticles.push({
              ...article,
              journalId: journal.id,
              journalName: JOURNAL_NAMES[journal.id] || journal.id,
            });
          }
        }
        
        allArticles.sort((a, b) => {
          const yearDiff = (parseInt(b.year) || 0) - (parseInt(a.year) || 0);
          if (yearDiff !== 0) return yearDiff;
          return (parseInt(b.volume) || 0) - (parseInt(a.volume) || 0);
        });

        const newsItems = allArticles.slice(0, 5);
        
        if (newsItems.length === 0) {
          container.innerHTML = '<div class="loading">記事が見つかりませんでした</div>';
          return;
        }

        container.innerHTML = newsItems.map(article => {
          const dateStr = article.year && article.volume 
            ? `${article.year}.${String(article.volume).padStart(2, '0')}` 
            : "";
          
          return `
            <a href="${article.link || 'articles.html'}" target="${article.link ? '_blank' : '_self'}" class="news-item">
              <span class="news-date">${dateStr}</span>
              <div class="news-content">
                <span class="news-category cat-articles">最新記事</span>
                <div class="news-text">${article.title}</div>
              </div>
            </a>
          `;
        }).join("");
        
      } catch (e) {
        console.error(e);
        container.innerHTML = '<div class="loading">データの取得に失敗しました</div>';
      }
    }

    loadNews();
  </script>
</body>
</html>
